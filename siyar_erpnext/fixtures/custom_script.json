[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2017-02-02 12:47:54.982059", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on('Sales Invoice', {\n\tcustomer : function(frm, cdt, cdn) {\n\t\t\n\t\t$.each(frm.doc.items, function(i, item_doc){\n\t\t\tupdate_discountPercentage(item_doc.name, item_doc.item_code, frm.doc.customer);\n\t\t});\n\t}\n});\n\n\nfrappe.ui.form.on('Sales Invoice Item', {\n\titem_code : function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\n\t\tupdate_discountPercentage(cdn, d.item_code, frm.doc.customer);\n\t}\n});\n\nvar update_discountPercentage = function(cdn, item_code, customer) {\n\t// if customer is not selected, return\n\t\tif (!customer || !item_code)\n\t\t\treturn;\n\t\n\t\n\tfrappe.after_ajax(function() {\t\t\n\t\t\t\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"siyar_erpnext.api.get_customer_item_discPercent\",\n\t\t\t\targs: {\n\t\t\t\t\t\"item\" : item_code, \n\t\t\t\t\t\"customer\" : customer\n\t\t\t\t},\n\t\t\t\tcallback: function(data){\n\t\t\t\t\tshow_alert(item_code + \" - \" + customer + \" : \" + data.message);\n\t\t\t\t\tfrappe.model.set_value(\"Sales Invoice Item\", cdn, \"discount_percentage\", data.message);\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\n\t\t});\n}", 
  "script_type": "Client"
 }
]